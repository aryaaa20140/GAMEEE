<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Battlefront Blitz â€” War Shooter (With Sound & Leaderboard)</title>
<style>
/* (singkat: styling mirip sebelumnya, tidak ditampilkan lengkap agar file tetap ringkas) */
:root{--bg:#070912;--panel:#081026;--neon:#ffcc00;--accent:#6ee7f8;--muted:#9aa4b2}
*{box-sizing:border-box;font-family:Inter, system-ui, Arial}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#03040a 0%,#071226 100%);color:#eaf6ff}
.container{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px}
.card{width:1000px;max-width:98%;border-radius:12px;padding:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 40px rgba(2,6,20,0.8)}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.title{display:flex;gap:12px;align-items:center}
.logo{width:48px;height:48px;border-radius:8px;background:linear-gradient(135deg,#0b1220,#0f1b2b);display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,204,0,0.06)}
.kbd{background:rgba(255,255,255,0.02);border-radius:6px;padding:6px 8px;border:1px solid rgba(255,255,255,0.03);font-size:13px;color:var(--muted)}
.main{display:flex;gap:12px;margin-top:12px}
.canvasWrap{flex:1}
canvas{width:820px;height:520px;background:linear-gradient(180deg,#071226 0%, #02030a 100%);display:block;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
.sidebar{width:260px;padding:10px;border-left:1px dashed rgba(255,255,255,0.02)}
.panel{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);margin-bottom:10px}
.small{font-size:13px;color:var(--muted)}
.footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <div class="header">
      <div class="title">
        <div class="logo">ðŸ”«</div>
        <div>
          <h1>Battlefront Blitz â€” War Shooter</h1>
          <div class="small">(with WebAudio SFX + PHP leaderboard)</div>
        </div>
      </div>
      <div>
        <button id="start">Start</button>
        <button id="restart">Restart</button>
      </div>
    </div>

    <div class="main">
      <div class="canvasWrap">
        <canvas id="game" width="820" height="520"></canvas>
      </div>

      <div class="sidebar">
        <div class="panel">
          <div class="small">Score: <span id="score">0</span></div>
          <div class="small">Health: <span id="hp">100</span></div>
          <div class="small">Wave: <span id="wave">0</span></div>
        </div>

        <div class="panel">
          <div class="small">Submit Score</div>
          <input id="name" placeholder="Nama (max 20)" style="width:100%;padding:6px;margin:6px 0;border-radius:6px;border:1px solid rgba(255,255,255,0.04)" />
          <button id="submitScore" style="width:100%">Submit to Leaderboard</button>
          <div id="submitMsg" class="small" style="margin-top:6px"></div>
        </div>

        <div class="panel small">
          <div>Top Leaderboard</div>
          <ol id="board" style="padding-left:18px;margin-top:8px"></ol>
          <button id="refreshBoard" style="margin-top:8px">Refresh</button>
        </div>

      </div>
    </div>

    <div class="footer">
      <div class="small">Controls: WASD / Arrows = Move, Mouse = Aim, Left Click = Shoot, 1/2/3 = Weapon</div>
      <div class="small">Server: PHP leaderboard (save leaderboard.php on a PHP-enabled host)</div>
    </div>
  </div>
</div>

<script>
// --- WebAudio SFX helper (no external files) ---
class SFX {
  constructor(){ this.ctx = null; }
  ensure(){ if(this.ctx) return; this.ctx = new (window.AudioContext || window.webkitAudioContext)(); }
  // short blip
  blip(freq=800, time=0.08){ this.ensure(); const o=this.ctx.createOscillator(); const g=this.ctx.createGain(); o.type='sine'; o.frequency.value=freq; g.gain.value=0.15; o.connect(g); g.connect(this.ctx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001, this.ctx.currentTime + time); o.stop(this.ctx.currentTime + time); }
  // explosion
  explosion(time=0.5){ this.ensure(); const bufferSize = this.ctx.sampleRate * time; const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate); const data = buffer.getChannelData(0); for(let i=0;i<bufferSize;i++){ data[i] = (Math.random()*2-1) * (1 - i/bufferSize) * Math.random(); } const src = this.ctx.createBufferSource(); src.buffer = buffer; const g = this.ctx.createGain(); g.gain.value = 0.4; src.connect(g); g.connect(this.ctx.destination); src.start(); }
  // rocket whoosh
  whoosh(){ this.ensure(); const o=this.ctx.createOscillator(); const f=this.ctx.createOscillator(); const g=this.ctx.createGain(); o.type='sawtooth'; f.type='sine'; o.frequency.value=240; f.frequency.value=6; f.connect(g.gain); o.connect(g); g.gain.value=0.06; g.connect(this.ctx.destination); o.start(); f.start(); setTimeout(()=>{ o.stop(); f.stop(); }, 300); }
}
const sfx = new SFX();

// --- simplified game logic (based on previous build) ---
(() => {
  const canvas = document.getElementById('game'); const ctx = canvas.getContext('2d'); const W=canvas.width, H=canvas.height;
  const startBtn = document.getElementById('start'), restartBtn=document.getElementById('restart');
  const scoreEl=document.getElementById('score'), hpEl=document.getElementById('hp'), waveEl=document.getElementById('wave');
  const submitBtn = document.getElementById('submitScore'), nameInput=document.getElementById('name'), boardEl=document.getElementById('board'), refreshBoard=document.getElementById('refreshBoard'), submitMsg=document.getElementById('submitMsg');

  let mouse={x:W/2,y:H/2,down:false};
  canvas.addEventListener('mousemove', e=>{ const r=canvas.getBoundingClientRect(); mouse.x = (e.clientX - r.left) * (canvas.width / r.width); mouse.y = (e.clientY - r.top) * (canvas.height / r.height); });
  canvas.addEventListener('mousedown', e=>{ mouse.down=true; sfx.blip(1000,0.03); }); canvas.addEventListener('mouseup', e=> mouse.down=false);
  const keys={}; window.addEventListener('keydown', e=> keys[e.key.toLowerCase()]=true); window.addEventListener('keyup', e=> keys[e.key.toLowerCase()]=false);

  function rnd(a,b){return Math.random()*(b-a)+a}

  // very small playable set (kept compact)
  class Player{ constructor(){ this.x=W/2; this.y=H/2; this.r=14; this.health=100; this.score=0; this.cool=0; this.weapon='rifle'; this.ammo={rifle:999,shotgun:40,rocket:4}; }
    update(){ let dx=0,dy=0; if(keys['w']||keys['arrowup']) dy-=1; if(keys['s']||keys['arrowdown']) dy+=1; if(keys['a']||keys['arrowleft']) dx-=1; if(keys['d']||keys['arrowright']) dx+=1; if(dx||dy){ const len=Math.hypot(dx,dy); this.x+=dx/len*3.2; this.y+=dy/len*3.2; }
      this.x = Math.max(this.r, Math.min(W-this.r, this.x)); this.y = Math.max(this.r, Math.min(H-this.r, this.y)); if(this.cool>0) this.cool--; if(keys['1']) this.weapon='rifle'; if(keys['2']) this.weapon='shotgun'; if(keys['3']) this.weapon='rocket'; if(mouse.down) this.shoot(); }
    shoot(){ if(this.cool>0) return; if(this.weapon==='rifle'){ bullets.push(new Bullet(this.x,this.y,Math.atan2(mouse.y-this.y, mouse.x-this.x),10,12,'player')); this.cool=8; this.ammo.rifle--; sfx.blip(1200,0.04);} else if(this.weapon==='shotgun'){ for(let i=0;i<6;i++){ bullets.push(new Bullet(this.x,this.y,Math.atan2(mouse.y-this.y, mouse.x-this.x) + rnd(-0.4,0.4), rnd(6,9),8,'player')); } this.cool=28; sfx.blip(900,0.06);} else { rockets.push(new Rocket(this.x,this.y,Math.atan2(mouse.y-this.y, mouse.x-this.x))); this.cool=90; sfx.whoosh(); } }
  }
  class Bullet{ constructor(x,y,a,s,d,o){ this.x=x;this.y=y;this.vx=Math.cos(a)*s;this.vy=Math.sin(a)*s;this.r=3;this.damage=d;this.owner=o;this.life=180; } update(){ this.x+=this.vx; this.y+=this.vy; this.life--; } draw(){ ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fillStyle = this.owner==='player' ? 'rgba(180,220,255,0.95)' : 'rgba(255,160,120,0.95)'; ctx.fill(); }}
  class Rocket{ constructor(x,y,a){ this.x=x;this.y=y;this.vx=Math.cos(a)*4;this.vy=Math.sin(a)*4;this.r=6;this.life=240; } update(){ this.x+=this.vx;this.y+=this.vy; this.life--; } draw(){ ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fillStyle='rgba(255,120,80,0.95)'; ctx.fill(); }}
  class Enemy{ constructor(x,y){ this.x=x;this.y=y;this.r=12;this.hp=30; this.speed=0.8; } update(){ const a=Math.atan2(player.y-this.y, player.x-this.x); this.x+=Math.cos(a)*this.speed; this.y+=Math.sin(a)*this.speed; } draw(){ ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fillStyle='rgba(255,120,120,0.12)'; ctx.fill(); ctx.strokeStyle='rgba(255,120,120,0.9)'; ctx.stroke(); }}

  let player, bullets=[], rockets=[], enemies=[], pickups=[]; let running=false, wave=0;
  function reset(){ player=new Player(); bullets=[]; rockets=[]; enemies=[]; pickups=[]; wave=0; spawnWave(); updateHUD(); }
  function spawnWave(){ wave++; for(let i=0;i<6+wave*2;i++){ const side=Math.floor(rnd(0,4)); let x=0,y=0; if(side===0){ x=rnd(-60,W+60); y=-60; } else if(side===1){ x=rnd(-60,W+60); y=H+60; } else if(side===2){ x=-60; y=rnd(-60,H+60);} else { x=W+60; y=rnd(-60,H+60);} enemies.push(new Enemy(x,y)); } }

  function updateHUD(){ scoreEl.textContent=Math.floor(player.score); hpEl.textContent=Math.max(0,Math.floor(player.health)); waveEl.textContent=wave; }

  function update(){ if(!running) return; player.update(); for(let i=bullets.length-1;i>=0;i--){ bullets[i].update(); if(bullets[i].life<=0) bullets.splice(i,1); }
    for(let i=rockets.length-1;i>=0;i--){ rockets[i].update(); if(rockets[i].life<=0) rockets.splice(i,1); }
    for(let i=enemies.length-1;i>=0;i--){ const e=enemies[i]; e.update(); // collisions
      for(let j=bullets.length-1;j>=0;j--){ const b=bullets[j]; if(b.owner==='player'){ const d=Math.hypot(b.x-e.x,b.y-e.y); if(d<e.r+b.r){ e.hp-=b.damage; bullets.splice(j,1); sfx.blip(600,0.03); if(e.hp<=0){ // death
                    player.score+=10; sfx.explosion(); enemies.splice(i,1); if(Math.random()<0.25) pickups.push({x:e.x+rnd(-6,6), y:e.y+rnd(-6,6), type: Math.random()<0.6?'health':'ammo'}); break; } } } }
      const d2=Math.hypot(player.x-e.x, player.y-e.y); if(d2 < e.r + player.r){ player.health -= 6; enemies.splice(i,1); sfx.explosion(); if(player.health<=0){ running=false; gameOver(); return; } }
    }
    // rockets hitting
    for(let i=rockets.length-1;i>=0;i--){ const r=rockets[i]; for(let j=enemies.length-1;j>=0;j--){ const e=enemies[j]; const d=Math.hypot(r.x-e.x,r.y-e.y); if(d < r.r + e.r + 6){ // big blast
            for(let k=enemies.length-1;k>=0;k--){ const e2=enemies[k]; const d2=Math.hypot(r.x-e2.x,r.y-e2.y); if(d2 < 80){ e2.hp -= 40*(1-d2/100); if(e2.hp<=0){ player.score+=10; enemies.splice(k,1); } } }
            sfx.explosion(); rockets.splice(i,1); break; } }
    }
    // pickups
    for(let i=pickups.length-1;i>=0;i--){ const p=pickups[i]; const d=Math.hypot(player.x-p.x, player.y-p.y); if(d < player.r + 8){ if(p.type==='health') player.health = Math.min(player.health+30, 120); else { player.ammo.rifle+=40; player.ammo.shotgun+=12; player.ammo.rocket+=1 } pickups.splice(i,1); } }

    if(enemies.length===0){ spawnWave(); }
    player.score += 0.02; updateHUD(); }

  function draw(){ ctx.clearRect(0,0,W,H); for(const b of bullets) b.draw(); for(const r of rockets) r.draw(); for(const e of enemies) e.draw(); for(const p of pickups){ ctx.beginPath(); ctx.arc(p.x,p.y,8,0,Math.PI*2); ctx.fillStyle = p.type==='health'?'rgba(90,255,120,0.95)':'rgba(120,180,255,0.95)'; ctx.fill(); }
    player.draw ? player.draw() : null; // player.draw included earlier in full version
    // crosshair
    ctx.beginPath(); ctx.arc(mouse.x, mouse.y, 6,0,Math.PI*2); ctx.strokeStyle='rgba(200,230,255,0.9)'; ctx.stroke(); }

  function loop(){ update(); draw(); if(running) requestAnimationFrame(loop); }

  function gameOver(){ // show simple overlay
    ctx.save(); ctx.fillStyle='rgba(0,0,0,0.6)'; ctx.fillRect(0,0,W,H); ctx.fillStyle='white'; ctx.textAlign='center'; ctx.font='28px Arial'; ctx.fillText('YOU DIED', W/2, H/2 - 8); ctx.font='14px Arial'; ctx.fillText('Your score: '+Math.floor(player.score), W/2, H/2 + 18); ctx.restore(); }

  startBtn.addEventListener('click', ()=>{ if(running) return; reset(); running=true; sfx.blip(1200,0.05); loop(); }); restartBtn.addEventListener('click', ()=>{ reset(); running=true; sfx.blip(1000,0.04); loop(); });

  // --- leaderboard functions (AJAX to PHP) ---
  async function refreshBoard(){ try{ const res = await fetch('leaderboard.php?top=1'); const json = await res.json(); boardEl.innerHTML=''; if(json.top){ for(const it of json.top){ const li = document.createElement('li'); li.textContent = ${it.name} â€” ${it.score}; boardEl.appendChild(li); } } }catch(err){ boardEl.innerHTML='<li>Error loading</li>'; } }
  refreshBoard(); refreshBoard.addEventListener('click', refreshBoard);

  submitBtn.addEventListener('click', async ()=>{
    const name = (nameInput.value||'Player').replace(/[^\w\s-]/g,'').slice(0,20);
    const score = Math.floor(player.score||0);
    submitMsg.textContent='Submitting...';
    try{
      const res = await fetch('leaderboard.php', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name,score}) });
      const j = await res.json(); if(j.ok){ submitMsg.textContent='Submitted!'; refreshBoard(); } else submitMsg.textContent = 'Error: ' + (j.error || 'unknown');
    }catch(err){ submitMsg.textContent='Network error'; }
  });

})();
</script>
</body>
</html>
